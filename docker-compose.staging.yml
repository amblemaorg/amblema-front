#USO-LOCAL - Use command docker-compose -f docker-compose.staging.yml up to set this specific .yml and up the docker-compose
version: "3.5"
services:
  web:
    container_name: amblema_front_staging
    image: devbinaural/nginx-angular:latest
    tty: true
    working_dir: "/home/amblema"
    ports:
      - 10512:80
    env_file:
      - .env
    volumes:
      - amblema_front_staging:/home/amblema
      - ./vhost-template.conf:/etc/nginx/conf.d/default.conf
    # command: >
    #   /bin/bash -c "npm install && npm run build && envsubst '$$NGINX_HOST$$NGINX_PORT$$NGINX_ROOT$$SSR_HOST$$SSR_PORT' < /home/amblema/vhost-template.conf > /etc/nginx/conf.d/default.conf && envsubst '$$G_MAPS_ID$$G_ANALYTICS_ID' < /home/amblema/src/index.template.html > /home/amblema/src/index.html && exec nginx -g 'daemon off;'"
    command: >
      /bin/bash -c  "envsubst '$$NGINX_HOST$$NGINX_PORT$$NGINX_ROOT$$SSR_HOST$$SSR_PORT' < /home/amblema/vhost-template.conf > /etc/nginx/conf.d/default.conf && exec nginx -g 'daemon off;'"
    networks:
      - default
volumes:
  amblema_front_staging:
    driver: local
    driver_opts:
      type: none
      device: ${PWD}
      o: bind
networks:
  default:
    external:
      name: amblema_db_network
