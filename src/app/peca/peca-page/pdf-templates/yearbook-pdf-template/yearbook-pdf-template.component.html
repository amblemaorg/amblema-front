<button class="btn btn-primary not-print" (click)="print()">Generar PDF</button>

<ng-container *ngIf="!!pdfData">
  <main class="yearbook-pdf">
    <ng-container *ngIf="frontpage">
      <ng-container
        *ngTemplateOutlet="frontpageTemplate; context: { frontpage: frontpage }"
      ></ng-container>
    </ng-container>

    <ng-container *ngIf="indexPage">
      <ng-container *ngTemplateOutlet="indexTemplate; context: { page: indexPage }"></ng-container>
    </ng-container>

    <ng-container *ngFor="let page of [mySchoolPage, coordinatorPage, godFatherPage, schoolPage]">
      <ng-container *ngIf="page">
        <ng-container *ngTemplateOutlet="layout2Template; context: { page: page }"></ng-container>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="schoolGradePageGroup">
      <ng-container *ngFor="let page of schoolGradePageGroup.pages">
        <ng-container
          *ngTemplateOutlet="
            schoolStudentListTemplate;
            context: {
              page: page
            }
          "
        ></ng-container>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="lapsePages">
      <ng-container *ngFor="let page of lapsePages">
        <ng-container *ngIf="page.templateName === 'diagnosticTemplate'">
          <ng-container
            *ngTemplateOutlet="diagnosticTemplate; context: { page: page }"
          ></ng-container>
        </ng-container>

        <ng-container *ngIf="page.templateName === 'activityTemplate'">
          <ng-container
            *ngTemplateOutlet="
              layout4Template;
              context: {
                page: page
              }
            "
          ></ng-container>
        </ng-container>

        <ng-container *ngIf="page.templateName === 'galleryTemplate'">
          <ng-container
            *ngTemplateOutlet="
              galleryTemplate;
              context: {
                page: page
              }
            "
          ></ng-container>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- <ng-container *ngFor="let page of lapsesDiagnosticTmpGroup">
      <ng-container *ngTemplateOutlet="diagnosticTemplate; context: { page: page }"></ng-container>
    </ng-container> -->
  </main>
</ng-container>

<div class="loading not-print" *ngIf="showLoading">
  <img src="../../../../../assets/images/amblema-loader.gif" />
  <p>Cargando...</p>
  <!-- <button [disabled]="!pdfData" (click)="print()">Imprimir PDF</button> -->
</div>

<!-- # Templates -->

<!-- indexTemplate -->
<ng-template #indexListItem let-listItems="listItems">
  <ng-container *ngIf="!isArray(listItems)">
    <ng-container *ngIf="listItems.show">
      <li>
        <ng-container *ngIf="listItems.href">
          <a [href]="'#' + listItems.href">{{ listItems.label }}</a>
          <span *ngIf="listItems.pageNumber"
            ><a [href]="'#' + listItems.href">{{ listItems.pageNumber }}</a></span
          >
        </ng-container>
        <ng-container *ngIf="!listItems.href"
          ><a>{{ listItems.label }}</a>
          <span *ngIf="listItems.pageNumber">{{ listItems.pageNumber }}</span>
        </ng-container>
      </li>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="isArray(listItems)">
    <ul>
      <ng-container *ngFor="let childItem of listItems">
        <ng-container
          *ngTemplateOutlet="indexListItem; context: { listItems: childItem }"
        ></ng-container>
      </ng-container>
    </ul>
  </ng-container>
</ng-template>

<ng-template #indexTemplate let-page="page">
  <section class="page background--generic">
    <div class="page__content layout--index">
      <div class="head">
        <h2>Indice</h2>
      </div>
      <div class="body">
        <ul class="list" [ngClass]="{ wrap: page.haveToWrapList(page.listItems) }">
          <ng-container *ngFor="let listItem of page.listItems">
            <ng-container
              *ngTemplateOutlet="indexListItem; context: { listItems: listItem }"
            ></ng-container>
          </ng-container>
        </ul>
      </div>
    </div>
  </section>
</ng-template>

<ng-template #diagnosticTemplate let-page="page">
  <section class="page background--generic" [id]="page.pgHref">
    <div class="page__content layout--diagnostic">
      <div class="head">
        <ng-container *ngIf="page.subtitle">
          <h3 class="text-center title">{{ page.subtitle }}</h3>
        </ng-container>
        <h2 class="text-center">{{ page.title }}</h2>
      </div>

      <div class="body">
        <div class="visual-references">
          <div class="graphic">
            <app-graphics-block [settings]="page.chart" [fitContainer]="true"></app-graphics-block>
          </div>

          <ng-container *ngIf="page.table.length > 0">
            <div class="table-container">
              <table class="table">
                <ng-container *ngFor="let tr of page.table; let trIdx = index">
                  <tr>
                    <ng-container *ngFor="let td of tr">
                      <td [attr.colspan]="trIdx === 0 ? '5' : 'auto'">
                        {{ td }}
                      </td>
                    </ng-container>
                  </tr>
                </ng-container>
              </table>
            </div>
          </ng-container>
        </div>

        <p class="description">
          <span [outerHTML]="page.description | excerpt: page.characterLimit | br"></span>
        </p>
      </div>
    </div>
    <div class="pager">
      <span>{{ page.page }}</span>
    </div>
  </section>
</ng-template>

<ng-template #layout2Template let-page="page">
  <section class="page background--generic" [id]="page.pgHref">
    <div class="page__content layout--2">
      <div class="head" [ngClass]="{ 'direction--reverse': page.isDirectionReverse }">
        <div class="heading">
          <div class="content">
            <h2>{{ page.title }}</h2>
            <ng-container *ngIf="page.subtitle">
              <h3>{{ page.subtitle }}</h3>
            </ng-container>
          </div>
        </div>

        <div class="container-img">
          <img [src]="page.img" />
        </div>
      </div>

      <p class="description">
        <span
          [outerHTML]="
            page.description
              | excerpt: yearbookConfig.getFormDescriptionLimit('historical-review-form')
              | br
          "
        ></span>
      </p>
    </div>
    <div class="pager">
      <span>{{ page.page }}</span>
    </div>
  </section>
</ng-template>

<!-- ## Layout 4 -->
<ng-template #layout4Template let-page="page">
  <section class="page background--generic" [id]="page.pgHref">
    <div class="page__content layout--4">
      <div class="body">
        <h2 class="text-capitalize title">
          {{ page.name }}
        </h2>

        <p class="description">
          <span [outerHTML]="page.description | excerpt: page.characterLimit | br"></span>
        </p>
      </div>

      <div class="gallery-container">
        <app-gallery
          [images]="page.images"
          [limit]="3"
          containerClasses="justify-content-between"
        ></app-gallery>
      </div>
    </div>
    <div class="pager">
      <span>{{ page.page }}</span>
    </div>
  </section>
</ng-template>

<!-- ## Gallery -->
<ng-template #galleryTemplate let-page="page">
  <section class="page {{ page.options.backgroundClass }}">
    <div class="page__content layout--gallery">
      <app-gallery
        [images]="page.images"
        [withSubtitle]="page.options.withSubtitle"
        [limit]="page.options.limit"
        [offset]="page.options.offset"
        itemStyle="max-height: 330px;"
        containerClasses="align-items-center"
      ></app-gallery>
    </div>
  </section>
</ng-template>

<!-- ## Customs -->

<!-- ### FrontPage Template -->
<ng-template #frontpageTemplate let-frontpage="frontpage">
  <section class="page background--front-page">
    <div class="page__content layout--front">
      <div class="head">
        <div class="headings">
          <!-- <p>{{ frontpage.data.schoolYear }}</p> -->
          <p class="primary-title">{{ frontpage.data.sponsorName }}</p>
        </div>
        <div class="partner-img">
          <img [src]="frontpage.data.sponsorLogo" />
        </div>
      </div>
      <div class="body">
        <h1>AmbLeMario</h1>
        <h2 class="school-name">{{ frontpage.data.schoolName }}</h2>
        <p class="primary-title">{{ frontpage.data.schoolYear }}</p>
      </div>
    </div>
  </section>
</ng-template>

<!-- ### SchoolSections -->
<ng-template #schoolStudentListTemplate let-page="page">
  <section class="page background--generic" [id]="page.pgHref">
    <div class="page__content layout--schoolSections">
      <div class="row body">
        <div class="col overflow--hidden {{ !page.isFirstColumnEmpty ? 'col--centered' : '' }}">
          <ng-container *ngIf="page.img">
            <div class="container-img">
              <img [src]="page.img" />
            </div>
          </ng-container>

          <ng-container *ngIf="page.isFirstColumnEmpty">
            <h2 class="text-capitalize">
              {{ page.name }}
            </h2>
          </ng-container>

          <ul class="list">
            <ng-container *ngFor="let name of page.students.firstColumn">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
        <div class="col overflow--hidden">
          <ng-container *ngIf="!page.isFirstColumnEmpty">
            <h2 class="text-capitalize">
              {{ page.name }}
            </h2>
          </ng-container>
          <!-- padding-top -->
          <ul class="list">
            <ng-container *ngFor="let name of page.students.secondColumn">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
      </div>
      <div class="teacher">
        <div class="name">
          <span>Docente:</span>
          <strong>{{ page.teacher.fullName }}</strong>
        </div>
      </div>
    </div>
    <div class="pager">
      <span>{{ page.page }}</span>
    </div>
  </section>
</ng-template>

<ng-template #smallSchoolSections let-data="data">
  <section class="page background--generic">
    <div class="page__content layout--schoolSections">
      <div class="row body">
        <div class="col overflow--hidden">
          <h2 class="text-capitalize">
            {{ data[0].sectionName }}
          </h2>

          <ul class="list">
            <ng-container *ngFor="let name of data[0].sectionStudents">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
        <div class="col overflow--hidden">
          <h2 class="text-capitalize">
            {{ data[1].sectionName }}
          </h2>
          <!-- <ng-container *ngIf="data.sectionImg">
            <div class="container-img">
              <img [src]="data[1].sectionImg" />
            </div>
          </ng-container> -->

          <ul class="list">
            <ng-container *ngFor="let name of data[1].sectionStudents">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
      </div>
    </div>
  </section>
</ng-template>
