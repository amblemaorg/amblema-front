<button class="btn btn-primary not-print" (click)="print()">Generar PDF</button>

<ng-container *ngIf="!!pdfData">
  <main class="yearbook-pdf">
    <ng-container *ngIf="!!frontpage">
      <ng-container
        *ngTemplateOutlet="frontpageTemplate; context: { frontpage: frontpage }"
      ></ng-container>
    </ng-container>

    <ng-container *ngIf="!!summaryAndCoordinatorPage">
      <ng-container
        *ngTemplateOutlet="
          layout2Template;
          context: { summaryAndCoordinatorPage: summaryAndCoordinatorPage }
        "
      ></ng-container>
    </ng-container>

    <ng-container *ngIf="!!godfatherPage">
      <ng-container
        *ngTemplateOutlet="
          layout3Template;
          context: { data: godfatherPage.data }
        "
      ></ng-container>
    </ng-container>

    <ng-container *ngIf="!!schoolPage">
      <ng-container
        *ngTemplateOutlet="layout3Template; context: { data: schoolPage.data }"
      ></ng-container>
    </ng-container>

    <ng-container *ngIf="!!schoolSectionsPage">
      <ng-container
        *ngFor="
          let schoolSectionSegmented of this.schoolSectionsPage.data
            .schoolSectionsSegmented
        "
      >
        <ng-container *ngIf="isArray(schoolSectionSegmented)">
          <ng-container
            *ngTemplateOutlet="
              smallSchoolSections;
              context: {
                data: schoolSectionSegmented
              }
            "
          ></ng-container>
        </ng-container>

        <ng-container *ngIf="!isArray(schoolSectionSegmented)">
          <ng-container
            *ngTemplateOutlet="
              largeSchoolSection;
              context: {
                data: schoolSectionSegmented,
                studentsSegmented: this.schoolSectionsPage.getStudentsSegmented(
                  schoolSectionSegmented.sectionStudents,
                  schoolSectionSegmented.sectionImg
                )
              }
            "
          ></ng-container>
        </ng-container>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="!!schoolSectionsPage">
      <ng-container *ngIf="schoolSectionsPage.data.galleryImgs.length > 0">
        <ng-container
          *ngFor="
            let galleryImgs of schoolSectionsPage.getGalleryImgsSegmented(
              schoolSectionsPage.data.galleryImgs
            )
          "
        >
          <ng-container
            *ngTemplateOutlet="
              galleryTemplate;
              context: {
                galleryImgs: galleryImgs
              }
            "
          ></ng-container>
        </ng-container>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="!!activitiesPage">
      <ng-container *ngFor="let lapse of activitiesPage.data.lapses">
        <ng-container *ngFor="let activity of lapse.activities; let i = index">
          <ng-container
            *ngTemplateOutlet="
              layout4Template;
              context: {
                data: activity,
                lapseName: lapse.lapseName,
                activityIdx: i
              }
            "
          ></ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  </main>
</ng-container>

<div class="loading not-print" *ngIf="showLoading">
  <img src="../../../../../assets/images/amblema-loader.gif" />
  <button [disabled]="!pdfData" (click)="print()">Imprimir PDF</button>
</div>

<!-- # Templates -->

<ng-template #layout2Template>
  <section class="page background--generic">
    <div class="page__content layout--2">
      <div class="row">
        <div class="col">
          <div class="container-img">
            <img [src]="summaryAndCoordinatorPage.data.historicalReviewImg" />
          </div>
        </div>

        <div class="col">
          <div>
            <h3 class="title">Reseña histórica</h3>
            <p>
              <span
                [outerHTML]="
                  summaryAndCoordinatorPage.data.historicalReviewText
                    | excerpt: 627
                    | br
                "
              ></span>
            </p>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div class="container-img">
            <img [src]="summaryAndCoordinatorPage.data.coordinatorImg" />
          </div>
        </div>

        <div class="col">
          <div>
            <h3 class="title">
              Coordinador/a
              {{ summaryAndCoordinatorPage.data.coordinatorName }}
            </h3>
            <p>
              <span
                [outerHTML]="
                  summaryAndCoordinatorPage.data.coordinatorText
                    | excerpt: 627
                    | br
                "
              ></span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</ng-template>

<ng-template #layout3Template let-data="data">
  <section class="page background--generic">
    <div class="page__content layout--3">
      <div class="row body">
        <div class="col col-img--centered">
          <div class="container-img">
            <img [src]="data.img" />
          </div>
        </div>
        <div class="col overflow--hidden">
          <p class="tag-title">{{ data.tagTitle }}</p>
          <h2 class="text-capitalize">
            {{ data.name }}
          </h2>

          <p>
            <span [outerHTML]="data.text | excerpt: 1005 | br"></span>
          </p>
        </div>
      </div>
    </div>
  </section>
</ng-template>

<!-- ## Layout 4 -->
<ng-template
  #layout4Template
  let-data="data"
  let-lapseName="lapseName"
  let-activityIdx="activityIdx"
>
  <section class="page background--generic">
    <div class="page__content layout--4">
      <div class="body">
        <h2 class="text-capitalize title">
          {{ activityIdx === 0 ? 'Actividades - ' + lapseName : data.name }}
        </h2>

        <ng-container *ngIf="activityIdx === 0">
          <h3 class="subtitle">{{ data.name }}</h3>
        </ng-container>

        <p class="first-letter--uppercase description">
          <span
            [outerHTML]="data.description || '' | excerpt: 1138 | br"
          ></span>
        </p>
      </div>

      <div class="gallery-container">
        <app-gallery
          [images]="data.images || []"
          [limit]="3"
          galleryContainerClasses="justify-content-between"
        ></app-gallery>
      </div>
    </div>
  </section>
</ng-template>

<!-- ## Gallery -->
<ng-template #galleryTemplate let-galleryImgs="galleryImgs">
  <section class="page background--generic">
    <div class="page__content layout--gallery">
      <app-gallery [images]="galleryImgs" [withSubtitle]="true"></app-gallery>
    </div>
  </section>
</ng-template>

<!-- ## Customs -->

<!-- ### FrontPage Template -->
<ng-template #frontpageTemplate let-frontpage="frontpage">
  <section class="page background--front-page">
    <div class="page__content layout--front">
      <div class="head">
        <div class="headings">
          <p>{{ frontpage.data.schoolYear }}</p>
          <p>{{ frontpage.data.sponsorName }}</p>
        </div>
        <div class="partner-img">
          <img [src]="frontpage.data.sponsorLogo" />
        </div>
      </div>
      <div class="body">
        <h1>AmbLeMario</h1>
        <h2>{{ frontpage.data.schoolName }}</h2>
      </div>
    </div>
  </section>
</ng-template>

<!-- ### SchoolSections -->
<ng-template
  #largeSchoolSection
  let-data="data"
  let-studentsSegmented="studentsSegmented"
>
  <section class="page background--generic">
    <div class="page__content layout--schoolSections">
      <div class="row body">
        <div class="col overflow--hidden">
          <h2 class="text-capitalize">
            {{ data.sectionName }}
          </h2>

          <ul class="list">
            <ng-container *ngFor="let name of studentsSegmented.large">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
        <div class="col overflow--hidden">
          <!-- <ng-container *ngIf="data.sectionImg">
            <div class="container-img">
              <img [src]="data.sectionImg" />
            </div>
          </ng-container> -->

          <ul class="list padding-top">
            <ng-container *ngFor="let name of studentsSegmented.small">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
      </div>
    </div>
  </section>
</ng-template>

<ng-template #smallSchoolSections let-data="data">
  <section class="page background--generic">
    <div class="page__content layout--schoolSections">
      <div class="row body">
        <div class="col overflow--hidden">
          <h2 class="text-capitalize">
            {{ data[0].sectionName }}
          </h2>

          <ul class="list">
            <ng-container *ngFor="let name of data[0].sectionStudents">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
        <div class="col overflow--hidden">
          <h2 class="text-capitalize">
            {{ data[1].sectionName }}
          </h2>
          <!-- <ng-container *ngIf="data.sectionImg">
            <div class="container-img">
              <img [src]="data[1].sectionImg" />
            </div>
          </ng-container> -->

          <ul class="list">
            <ng-container *ngFor="let name of data[1].sectionStudents">
              <li>{{ name }}</li>
            </ng-container>
          </ul>
        </div>
      </div>
    </div>
  </section>
</ng-template>
