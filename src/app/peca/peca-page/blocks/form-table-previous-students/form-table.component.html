<div>
  <ng-container
    *ngTemplateOutlet="
      formTemplate;
      context: { fieldsarr: fields1, type: 1, frmlr: form1 }
    "
  ></ng-container>

  <div class="table-wrapper">
    <div class="the-table" [class.disabled]="disabledThis()">
      <div class="table-element">
        <ng2-smart-table
          [settings]="tableStudents"
          [source]="source"
          (userRowSelect)="onUserRowSelect($event)"
          class="is-multi"
        ></ng2-smart-table>
      </div>

      <div
        *ngIf="
          settings &&
          settings.fields &&
          settings.fields.table &&
          settings.fields.table.length
        "
        class="promote-wrapper"
        [class.disabled]="!selectedRows.length"
      >
        <h6>Datos a promover</h6>
        <ng-container
          *ngTemplateOutlet="
            formTemplate;
            context: { fieldsarr: fields2, type: 2, frmlr: form2 }
          "
        ></ng-container>
      </div>
    </div>
  </div>
</div>

<!-- FORM TEMPLATE -->
<ng-template
  #formTemplate
  let-fieldsarr="fieldsarr"
  let-type="type"
  let-frmlr="frmlr"
>
  <form [formGroup]="frmlr" (ngSubmit)="onSubmitAction(frmlr.value)">
    <div class="fields-container">
      <ng-container *ngFor="let field of fieldsarr; index as ind">
        <div class="form-group">
          <label>{{ settings.fields["fields" + type][field].label }}</label>
          <ng-select
            class="form-control"
            notFoundText="Elementos no encontrados"
            [items]="settings.fields['fields' + type][field].items"
            bindValue="id"
            bindLabel="name"
            [labelForId]="settings.fields['fields' + type][field].id"
            [formControlName]="field"
            [virtualScroll]="true"
            [id]="settings.fields['fields' + type][field].id"
            [placeholder]="settings.fields['fields' + type][field].placeholder"
            (change)="setSelect(field, $event)"
            [readonly]="disabledThis() || (type === 2 && !selectedRows.length)"
          >
            <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
              <small>{{ item.name }}</small>
            </ng-template>
          </ng-select>
          <span
            *ngIf="settings.fields['fields' + type][field].loading"
            class="floating-loading"
            >{{ settings.fields["fields" + type][field].loadingLabel }}</span
          >
          <ng-container *ngIf="hasErrors(frmlr, field)">
            <div class="error-message">
              <strong>{{ hasErrors(frmlr, field) }}</strong>
            </div>
          </ng-container>
        </div>
      </ng-container>
      <!-- BUTTON -->
      <ng-container *ngIf="type === 1; else otherType">
        <button
          type="submit"
          class="btn btn-primary text-decoration-none py-1 px-4"
          [disabled]="disabledThis(type)"
        >
          <span *ngIf="isSearching" class="spinner-grow spinner-grow-sm"></span>
          {{ isSearching ? "Buscando..." : "Buscar" }}
        </button>
      </ng-container>
      <ng-template #otherType>
        <button
          type="button"
          class="btn btn-primary text-decoration-none py-1 px-4"
          [disabled]="disabledThis(type) || !selectedRows.length"
          (click)="takeAction()"
        >
          <span *ngIf="isSaving" class="spinner-grow spinner-grow-sm"></span>
          {{ isSaving ? "Promoviendo..." : "Promover" }}
        </button>
      </ng-template>
    </div>
  </form>
</ng-template>
